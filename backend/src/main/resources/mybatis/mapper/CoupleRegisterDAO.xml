<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.playhere.couple.ICoupleRegisterService">

    <!-- 커플 등록 -->
    <insert id="createCouple" parameterType="map" useGeneratedKeys="true" keyProperty="coupleId" keyColumn="couple_id">
    INSERT INTO couple (couple_id, user_id_1, user_id_2)
    VALUES (COUPLE_SEQ.NEXTVAL, #{userId1}, #{userId2})
	</insert>

    <!-- member 테이블에 couple_id, couple_status 업데이트 -->
    <update id="updateCoupleStatus" parameterType="map">
        UPDATE member
        SET couple_id = #{coupleId}, couple_status = #{coupleStatus}
        WHERE user_id = #{userId}
    </update>
    
    <delete id="deleteCouple">
        DELETE FROM couple WHERE couple_id = #{coupleId}
    </delete>

    <delete id="deleteCoupleCode">
        DELETE FROM couple_code WHERE user_id = #{userId}
    </delete>
    
    
    <!--  couple 테이블에서 해당 couple_id 삭제 -->
    <delete id="disconnectCouple">
    DELETE FROM couple WHERE couple_id = (SELECT couple_id FROM member WHERE user_id = #{userId})
	</delete>
    

</mapper>